= Before Upgrade

Note that Hue auth with kerberos has been removed, in order to use Admin user in a simpler way (as it has access to all data).

== HBase

Insertion is working well:

[source,bash]
----
hbase(main):001:0> list
TABLE                                                                                                                                                                        
ATLAS_ENTITY_AUDIT_EVENTS                                                                                                                                                    
atlas_janus                                                                                                                                                                  
randomy                                                                                                                                                                      
test1                                                                                                                                                                        
4 row(s)
Took 0.8724 seconds                                                                                                                                                          
=> ["ATLAS_ENTITY_AUDIT_EVENTS", "atlas_janus", "randomy", "test1"]
hbase(main):002:0> count 'randomy'
Current count: 140000, row: Zuzana2019-01-27Mali                                                                                                                             
140000 row(s)
Took 15.2539 seconds                                                                                                                                                         
=> 140000
hbase(main):003:0> 
----

== HDFS

Insertion is working well:

[source,bash]
----
[frisch@cdp-test-1 ~]$ hdfs dfs -ls -h /user/frisch
Found 1 items
-rw-r--r--   3 frisch supergroup      2.6 M 2020-03-30 00:18 /user/frisch/randomy.csv
----


== SolR

Insertion is working well:

image::pictures/HueSolRResults.png[SolR resulst from Hue]

== Ozone

Insertion is working well:

[source,bash]
----
[frisch@cdp-test-1 ~]$ ozone sh volume list /
{
  "metadata" : { },
  "name" : "randomy",
  "admin" : "frisch@FRISCH.COM",
  "owner" : "frisch@FRISCH.COM",
  "creationTime" : 1585552623861,
  "acls" : [ {
    "type" : "USER",
    "name" : "frisch@FRISCH.COM",
    "aclScope" : "ACCESS",
    "aclList" : [ "ALL" ]
  }, {
    "type" : "GROUP",
    "name" : "frisch",
    "aclScope" : "ACCESS",
    "aclList" : [ "ALL" ]
  } ],
  "quota" : 1152921504606846976
}
----


== Hive

Insertion is working well but is very very very slow... :

image::pictures/HiveHueResultsRandomy_tab.png[Hive results from Hue]


== Kafka

Kafka insertions actually works in console on the cluster, but not with Java, it seems something is not working with Java (maybe Java dependencies).

jaas.config:
[source,bash]
----
KafkaClient {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    storeKey=true
    useTicketCache=true
    keyTab="/home/frisch/frisch.keytab"
    principal="frisch@FRISCH.COM";
};
----

producer.properties:
[source,bash]
bootstrap.servers=cdp-test-4.gce.cloudera.com:9093
security.protocol=SASL_SSL
ssl.truststore.location=/opt/cloudera/security/pki/truststore.jks
ssl.truststore.password=cloudera
ssl.keystore.location=/opt/cloudera/security/pki/keystore.jks
ssl.keystore.password=cloudera
ssl.key.password=cloudera
sasl.mechanism=GSSAPI
sasl.kerberos.service.name=kafka

[source,bash]
export KAFKA_OPTS="-Djava.security.auth.login.config=/opt/cloudera/parcels/CDH/lib/kafka/bin/jaas.config"

[source,bash]
----
cd /opt/cloudera/parcels/CDH/lib/kafka/bin/
kafka-console-producer --broker-list cdp-test-4.gce.cloudera.com:9093 --topic test --producer.config producer.properties

....

20/03/30 02:08:16 INFO kerberos.KerberosLogin: [Principal=frisch@FRISCH.COM]: TGT refresh thread started.
20/03/30 02:08:16 INFO kerberos.KerberosLogin: [Principal=frisch@FRISCH.COM]: TGT valid starting at: Mon Mar 30 02:08:16 PDT 2020
20/03/30 02:08:16 INFO kerberos.KerberosLogin: [Principal=frisch@FRISCH.COM]: TGT expires: Tue Mar 31 02:08:16 PDT 2020
20/03/30 02:08:16 INFO kerberos.KerberosLogin: [Principal=frisch@FRISCH.COM]: TGT refresh sleeping until: Mon Mar 30 21:53:23 PDT 2020
20/03/30 02:08:16 INFO utils.AppInfoParser: Kafka version: 2.3.0.7.0.3.0-79
20/03/30 02:08:16 INFO utils.AppInfoParser: Kafka commitId: 7df36e7ddd0676a5
20/03/30 02:08:16 INFO utils.AppInfoParser: Kafka startTimeMs: 1585559296554
>20/03/30 02:08:16 INFO clients.Metadata: [Producer clientId=console-producer] Cluster ID: DzlLGaw2R7ywvGOsKwZ3PA
scbvqhjc
20/03/30 02:08:20 WARN clients.NetworkClient: [Producer clientId=console-producer] Error while fetching metadata with correlation id 3 : {test=LEADER_NOT_AVAILABLE}
>dcs
>csd
>cs
>csd

----

[source,bash]
----
cd /opt/cloudera/parcels/CDH/lib/kafka/bin/
kafka-console-consumer.sh --bootstrap-server cdp-test-4.gce.cloudera.com:9093 --topic test --consumer.config consumer.properties --from-beginning

....

20/03/30 02:08:31 INFO internals.ConsumerCoordinator: [Consumer clientId=consumer-1, groupId=console-consumer-507] Revoking previously assigned partitions []
20/03/30 02:08:31 INFO internals.AbstractCoordinator: [Consumer clientId=consumer-1, groupId=console-consumer-507] (Re-)joining group
20/03/30 02:08:31 INFO internals.AbstractCoordinator: [Consumer clientId=consumer-1, groupId=console-consumer-507] (Re-)joining group
20/03/30 02:08:34 INFO internals.AbstractCoordinator: [Consumer clientId=consumer-1, groupId=console-consumer-507] Successfully joined group with generation 1
20/03/30 02:08:34 INFO internals.ConsumerCoordinator: [Consumer clientId=consumer-1, groupId=console-consumer-507] Setting newly assigned partitions: test-0
20/03/30 02:08:34 INFO internals.ConsumerCoordinator: [Consumer clientId=consumer-1, groupId=console-consumer-507] Found no committed offset for partition test-0
20/03/30 02:08:34 INFO internals.SubscriptionState: [Consumer clientId=consumer-1, groupId=console-consumer-507] Resetting offset for partition test-0 to offset 0.
scbvqhjc
dcs
csd
cs
csd
----