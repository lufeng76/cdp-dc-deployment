= Troubleshoots

**目录**

. Ranger +
.. <<Collection not found: ranger_audits>> +
. Atlas +
.. <<PAM Authentication Failed>>

== Ranger

=== Collection not found: ranger_audits

**症状：** Ranger Audit UI报错：

image::pictures/TS001.jpg[ranger_audits]

**根源：** 在添加Ranger和Atlas服务之前，集群必须启用kerberos。Ranger的configset中<lib>相关item无法在非安全的集群中使用。

**解决方案：** 

. 集群启用Kerberos +
. 停止Slor和Ranger服务 +
. 执行命令：solrctl --zk ccycloud-1.feng.root.hwx.site:2181,ccycloud-2.feng.root.hwx.site:2181,ccycloud-3.feng.root.hwx.site:2181/solr-infra instancedir --delete ranger_audits +
. 启动Slor和Ranger服务


== Atlas

=== PAM Authentication Failed

**症状：** Atlas日志报错：
....
[etp1073763441-106:] ~ Error while PAM authentication (AtlasAuthenticationProvider:119)
org.apache.atlas.web.security.AtlasAuthenticationException: PAM Authentication Failed
        at org.apache.atlas.web.security.AtlasPamAuthenticationProvider.authenticate(AtlasPamAuthenticationProvider.java:69)
        at org.apache.atlas.web.security.AtlasAuthenticationProvider.authenticate(AtlasAuthenticationProvider.java:117)
        at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:174)
        at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:199)
        at org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter.attemptAuthentication(UsernamePasswordAuthenticationFilter.java:94)
        at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:212)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:116)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
....
**根源：** CDP7.1默认开了PAM，导致file based auth user 失效。

**解决方案：** 将下面的勾去掉，然后重启Atlas服务。

image::pictures/TS002.png[Atlas PAM]

