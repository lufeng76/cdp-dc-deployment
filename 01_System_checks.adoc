= 前置工作之系统检查

**目录**

. 演示环境介绍 +
.. <<修改hosts文件>> +
.. <<免密登录>> +
. Linux主机配置修改 +
.. <<禁用SELinux>> +
.. <关闭防火墙> +
.. 集群时钟同步 +
.. 更改文件句柄数 +
.. 设置swap +
.. 设置透明大页面 +
.. 配置操作系统repo +
.. 安装httpd服务 +

== 演示环境介绍

image::pictures/OV002.png[demo envrionment]

[%hardbreaks]
**注意：** 建议所有的操作都在 `终端服务器` 上完成，包括远程执行script.sh和CM页面操作。

=== 修改hosts文件

普通Linux服务器：
....
echo "127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
172.27.14.129   ccycloud-1.feng.root.hwx.site   feng-1
172.27.170.65   ccycloud-2.feng.root.hwx.site   feng-2
172.27.115.6   ccycloud-3.feng.root.hwx.site   feng-3
172.27.17.134   ccycloud-4.feng.root.hwx.site   feng-4
172.27.126.77   ccycloud-5.feng.root.hwx.site   feng-5
" > /etc/hosts
....

YCloud Linux服务器：
....
echo "127.0.0.1	localhost
::1	localhost ip6-localhost ip6-loopback
fe00::0	ip6-localnet
ff00::0	ip6-mcastprefix
ff02::1	ip6-allnodes
ff02::2	ip6-allrouters
172.27.14.129   ccycloud-1.feng.root.hwx.site   feng-1
172.27.170.65   ccycloud-2.feng.root.hwx.site   feng-2
172.27.115.6   ccycloud-3.feng.root.hwx.site   feng-3
172.27.17.134   ccycloud-4.feng.root.hwx.site   feng-4
172.27.126.77   ccycloud-5.feng.root.hwx.site   feng-5
" > /etc/hosts
....

=== 免密登录

终端服务必须和集群各节点配置免密登录。
....
ssh-keygen ---一直敲回车到最后
ssh-copy-id -i .ssh/id_rsa.pub root@ccycloud-1.feng.root.hwx.site
ssh-copy-id -i .ssh/id_rsa.pub root@ccycloud-2.feng.root.hwx.site
ssh-copy-id -i .ssh/id_rsa.pub root@ccycloud-3.feng.root.hwx.site
ssh-copy-id -i .ssh/id_rsa.pub root@ccycloud-4.feng.root.hwx.site
ssh-copy-id -i .ssh/id_rsa.pub root@ccycloud-5.feng.root.hwx.site
....

=== 运行脚本install_full_script.sh

. 打开link:install_full_script.sh[install_full_script.sh]，将其中的部分代码拷贝到link:script.sh[script.sh]中 +
. 在配置免密登录之后，在**终端服务器上**可以通过以下方式执行脚本：+
.. sh single_thread_execution.sh +
.. sh multi_thread_execution.sh

== Linux主机配置修改

以下部分可以通过link:install_full_script.sh[install_full_script.sh]执行生效。

=== 禁用SELinux

=== 关闭防火墙
=== 集群时钟同步
=== 更改文件句柄数
=== 设置swap
=== 设置透明大页面
=== 配置操作系统repo
=== 安装httpd服务

Check names are correct for all nodes and check IPV6 is not used and also jumbo frames:

[source,bash]
cat /etc/hosts
cat /etc/sysconfig/network
uname -a
ifconfig


Setup correct /etc/hosts on all nodes:

[source,bash]


== Firewall

Disable and stop firewall and iptables:

[source,bash]
systemctl disable firewalld
systemctl stop firewalld


== SELinux

Check it is disabled:

[source,bash]
getenforce


== NTP

Check NTP or chronyd is working:

[source,bash]
systemctl status chronyd


If not, install it.


== File System

Check that file limit is above 64000:

[source,bash]
ulimit -Sn
ulimit -Hn

If not, raise it by modifying /etc/sysctl.conf file with fs.file-max = 64000

[source,bash]
echo "fs.file-max = 64000" >> /etc/sysctl.conf

Check file system is in noatime (or at least relatime) mode:

[source,bash]
cat /proc/mounts

Check umask:

[source,bash]
umask


== Memory

Check Huge page disabled (set to 0):

[source,bash]
grep HugePages /proc/meminfo 
cat /sys/kernel/mm/transparent_hugepage/enabled
cat /sys/kernel/mm/transparent_hugepage/defrag

If they are not set to never, change it with this command:

[source,bash]
echo never > /sys/kernel/mm/redhat_transparent_hugepage/enabled
echo never > /sys/kernel/mm/redhat_transparent_hugepage/defrag

Check swappiness disabled (set to 0):

[source,bash]
cat /proc/sys/vm/swappiness

If it is not set to 0, change it with this command:
[source,bash]
echo 0 > /proc/sys/vm/swappiness

Check Memory virtual usage:

In /etc/sysctl.conf, check these settings:

[source,bash]
vm.dirty_background_ratio=20
vm.dirty_ratio=50

If not set, add it using:
[source,bash]
echo "vm.dirty_background_ratio=20
vm.dirty_ratio=50" >> /etc/sysctl.conf

== CPU

Check Performance scaling is set:

[source,bash]
cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor

If result is not "performance", and especially if it is "powersave", you can configure them:
[source,bash]
echo performance > /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor


== Libs installed

Check that following libs are installed on each node:

[source,bash]
yum (RHEL/CentOS/Oracle)
sed
service
/sbin/chkconfig (RHEL/CentOS/Oracle)
id
rm
mv
chown
install

